Microsoft (R) Macro Assembler Version 14.16.27048.0	    08/08/22 12:58:33
CreateStruct_.asm					     Page 1 - 1


					.model flat, c
					include TestStruct_.inc
 00000010		      C TestStruct struct
 00000000  00		      C 	Val8 byte ?
 00000001  00		      C 	Pad8 byte ?
 00000002  0000		      C 	Val16 word ?
 00000004  00000000	      C 	Val32 dword ?
 00000008  0000000000000000   C 	Val64 qword ?
			      C TestStruct ends
			      C 
					extern malloc:proc
					extern free:proc
 00000000				.code
				; extern "C" TestStruct * CreateStruct_(__int8, __int16, __int32, __int64);
				; Description:	This function allocate and initializes a new TestStruct
				; Return:		A pointer to the new TestStruct or NULL
 00000000			CreateStruct_ proc
 00000000  55				push ebp
 00000001  8B EC			mov ebp, esp

				; Allocate a block memory
				; malloc return a memory block to eax
 00000003  6A 10			push sizeof TestStruct
 00000005  E8 00000000 E		call malloc
 0000000A  83 C4 04			add esp, 4
 0000000D  0B C0			or eax, eax				; NULL pointer Test
 0000000F  74 1F			jz MallocError			; Jump if malloc failed.

				; Initialize the new TestStruct
 00000011  8A 55 08			mov dl, [ebp + 8]
 00000014  88 10			mov [eax + TestStruct.Val8], dl

 00000016  66| 8B 55 0C			mov dx, [ebp + 12]
 0000001A  66| 89 50 02			mov [eax + TestStruct.Val16], dx

 0000001E  8B 55 10			mov edx, [ebp + 16]
 00000021  89 50 04			mov [eax + TestStruct.Val32], edx

 00000024  8B 4D 14			mov ecx, [ebp + 20]
 00000027  8B 55 18			mov edx, [ebp + 24]
 0000002A  89 48 08			mov dword ptr [eax + TestStruct.Val64], ecx
 0000002D  89 50 0C			mov dword ptr [eax + TestStruct.Val64 + 4], edx

 00000030			MallocError:
 00000030  5D				pop ebp 
 00000031  C3				ret

 00000032			CreateStruct_ endp

				; extern "C" void ReleaseTestStruct_(TestStruct *);
				; Description:	This funciton release a previously created TestStruct
				; Return:		None
 00000032			ReleaseTestStruct_ proc
 00000032  55				push ebp
 00000033  8B EC			mov ebp, esp

				; Call free() to release previously created TestStruct
 00000035  FF 75 08			push [ebp + 8]
 00000038  E8 00000000 E		call free
 0000003D  83 C4 04			add esp, 4

 00000040  5D				pop ebp 
 00000041  C3				ret
 00000042			ReleaseTestStruct_ endp
					end
Microsoft (R) Macro Assembler Version 14.16.27048.0	    08/08/22 12:58:33
CreateStruct_.asm					     Symbols 2 - 1




Structures and Unions:

                N a m e                  Size
                                         Offset      Type

TestStruct . . . . . . . . . . .	 00000010
  Val8 . . . . . . . . . . . . .	 00000000	 Byte
  Pad8 . . . . . . . . . . . . .	 00000001	 Byte
  Val16  . . . . . . . . . . . .	 00000002	 Word
  Val32  . . . . . . . . . . . .	 00000004	 DWord
  Val64  . . . . . . . . . . . .	 00000008	 QWord


Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

FLAT . . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	32 Bit	 00000000 Para	  Public  'DATA'	
_TEXT  . . . . . . . . . . . . .	32 Bit	 00000042 Para	  Public  'CODE'	


Procedures, parameters, and locals:

                N a m e                 Type     Value    Attr

CreateStruct_  . . . . . . . . .	P Near	 00000000 _TEXT	Length= 00000032 Public C
  MallocError  . . . . . . . . .	L Near	 00000030 _TEXT	
ReleaseTestStruct_ . . . . . . .	P Near	 00000032 _TEXT	Length= 00000010 Public C


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 00000000h   
@DataSize  . . . . . . . . . . .	Number	 00000000h   
@Interface . . . . . . . . . . .	Number	 00000001h   
@Model . . . . . . . . . . . . .	Number	 00000007h   
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 FLAT
@fardata?  . . . . . . . . . . .	Text   	 FLAT
@fardata . . . . . . . . . . . .	Text   	 FLAT
@stack . . . . . . . . . . . . .	Text   	 FLAT
free . . . . . . . . . . . . . .	L Near	 00000000 FLAT	External C
malloc . . . . . . . . . . . . .	L Near	 00000000 FLAT	External C

	   0 Warnings
	   0 Errors
